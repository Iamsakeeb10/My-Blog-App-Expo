import { useEffect, useState } from "react";
import { ActivityIndicator, FlatList, View } from "react-native";
import BlogPost from "./BlogPost";

const Blogs = () => {
  const [posts, setPosts] = useState([]);
  const [pageNumber, setPageNumber] = useState(1);
  const [isLoading, setIsLoading] = useState(false);
  const [hasMore, setHasMore] = useState(true);

  const postsPerPage = 5;

  const url = `https://jsonplaceholder.typicode.com/posts?_page=${pageNumber}&_limit=${postsPerPage}`;

  useEffect(() => {
    getPosts();
  }, []);

  async function getPosts() {
    setIsLoading(true);
    try {
      const response = await fetch(url);

      const data = await response.json();
      console.log(data);

      // 10 posts
      // const slicedData = data.slice(0, 10);
      setPosts([...posts, ...data]);
      setPageNumber(pageNumber + 1);

      if (data.length == 0) {
        setHasMore(false);
      }
    } catch (err) {
      console.log(err);
    } finally {
      setIsLoading(false);
    }
  }

  function renderLoader() {
    return isLoading ? (
      <ActivityIndicator size="large" color="#153448" />
    ) : null;
  }

  return (
    <View style={{ flex: 1 }}>
      <FlatList
        data={posts}
        renderItem={({ item }) => <BlogPost item={item} />}
        keyExtractor={(item) => item.id.toString()}
        onEndReached={hasMore ? getPosts : null}
        onEndReachedThreshold={0.5}
        ListFooterComponent={renderLoader}
      />
    </View>
  );
};

export default Blogs;
